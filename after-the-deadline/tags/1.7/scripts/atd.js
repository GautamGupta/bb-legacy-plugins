var EXPORTED_SYMBOLS=["AtDCore"];function AtDCore(){this.ignore_types=["Bias Language","Cliches","Complex Expression","Diacritical Marks","Double Negatives","Hidden Verbs","Jargon Language","Passive voice","Phrases to Avoid","Redundant Expression"];this.ignore_strings={};this.i18n=AtD}AtDCore.prototype.getLang=function(a,b){if(AtD[a]==undefined)return b;return AtD[a]};AtDCore.prototype.addI18n=function(a){this.i18n=a}; AtDCore.prototype.setIgnoreStrings=function(a){var b=this;this.map(a.split(/,\s*/g),function(c){b.ignore_strings[c]=1})}; AtDCore.prototype.showTypes=function(a){a=a.split(/,\s*/g);var b={};b["Double Negatives"]=1;b["Hidden Verbs"]=1;b["Passive voice"]=1;b["Bias Language"]=1;b.Cliches=1;b["Complex Expression"]=1;b["Diacritical Marks"]=1;b["Jargon Language"]=1;b["Phrases to Avoid"]=1;b["Redundant Expression"]=1;var c=[];this.map(a,function(e){b[e]=undefined});this.map(this.ignore_types,function(e){b[e]!=undefined&&c.push(e)});this.ignore_types=c}; AtDCore.prototype.makeError=function(a,b,c,e){var d={};d.type=c;d.string=a;d.tokens=b;d.regexp=(new RegExp("\\b"+a+"\\b")).test(a)?new RegExp("(?!"+a+"<)\\b"+a.replace(/\s+/g,e)+"\\b"):(new RegExp(a+"\\b")).test(a)?new RegExp("(?!"+a+"<)"+a.replace(/\s+/g,e)+"\\b"):(new RegExp("\\b"+a)).test(a)?new RegExp("(?!"+a+"<)\\b"+a.replace(/\s+/g,e)):new RegExp("(?!"+a+"<)"+a.replace(/\s+/g,e));d.used=false;return d}; AtDCore.prototype.addToErrorStructure=function(a,b,c,e){var d=this;this.map(b,function(f){var m=f.word.split(/\s+/),j=f.pre,g=m[0];if(a["__"+g]==undefined){a["__"+g]={};a["__"+g].pretoks={};a["__"+g].defaults=[]}if(j=="")a["__"+g].defaults.push(d.makeError(f.word,m,c,e,j));else{if(a["__"+g].pretoks["__"+j]==undefined)a["__"+g].pretoks["__"+j]=[];a["__"+g].pretoks["__"+j].push(d.makeError(f.word,m,c,e,j))}})}; AtDCore.prototype.buildErrorStructure=function(a,b,c){var e=this._getSeparators(),d={};this.addToErrorStructure(d,a,"hiddenSpellError",e);this.addToErrorStructure(d,c,"hiddenGrammarError",e);this.addToErrorStructure(d,b,"hiddenSuggestion",e);return d};AtDCore.prototype._getSeparators=function(){var a="",b;for(b=0;b<28;b++)a+="\\"+'"s!#$%&()*+,./:;<=>?@[]^_{|}'.charAt(b);return"(?:(?:[\u00a0"+a+"])|(?:\\-\\-))+"}; AtDCore.prototype.processXML=function(a){var b={};this.map(this.ignore_types,function(s){b[s]=1});this.suggestions=[];var c=a.getElementsByTagName("error");a=[];for(var e=[],d=[],f=0;f<c.length;f++)if(c[f].getElementsByTagName("string").item(0).firstChild!=null){var m=c[f].getElementsByTagName("string").item(0).firstChild.data,j=c[f].getElementsByTagName("type").item(0).firstChild.data,g=c[f].getElementsByTagName("description").item(0).firstChild.data,i;i=c[f].getElementsByTagName("precontext").item(0).firstChild!= null?c[f].getElementsByTagName("precontext").item(0).firstChild.data:"";if(this.ignore_strings[m]==undefined){var l={};l.description=g;l.suggestions=[];l.matcher=new RegExp("^"+m.replace(/\s+/,this._getSeparators())+"$");l.context=i;l.string=m;l.type=j;this.suggestions.push(l);if(c[f].getElementsByTagName("suggestions").item(0)!=undefined)for(var h=c[f].getElementsByTagName("suggestions").item(0).getElementsByTagName("option"),o=0;o<h.length;o++)l.suggestions.push(h[o].firstChild.data);if(c[f].getElementsByTagName("url").item(0)!= undefined){h=c[f].getElementsByTagName("url").item(0).firstChild.data;l.moreinfo=h+"&theme=tinymce"}if(b[g]==undefined){j=="suggestion"&&d.push({word:m,pre:i});j=="grammar"&&a.push({word:m,pre:i})}if(j=="spelling"||g=="Homophone")e.push({word:m,pre:i});if(g=="Cliches")l.description="Clich&eacute;s";if(g=="Spelling")l.description=this.getLang("menu_title_spelling","Spelling");if(g=="Repeated Word")l.description=this.getLang("menu_title_repeated_word","Repeated Word");if(g=="Did you mean...")l.description= this.getLang("menu_title_confused_word","Did you mean...")}}c=e.length+a.length+d.length;return{errors:c>0?this.buildErrorStructure(e,d,a):undefined,count:c,suggestions:this.suggestions}}; AtDCore.prototype.findSuggestion=function(a){var b=a.innerHTML,c=(this.getAttrib(a,"pre")+"").replace(/[\\,!\\?\\."\s]/g,"");this.getAttrib(a,"pre")==undefined&&alert(a.innerHTML);a=undefined;for(var e=this.suggestions.length,d=0;d<e;d++)if((c==""||c==this.suggestions[d].context)&&this.suggestions[d].matcher.test(b)){a=this.suggestions[d];break}return a};function TokenIterator(a){this.tokens=a;this.last=this.count=this.index=0} TokenIterator.prototype.next=function(){var a=this.tokens[this.index];this.count=this.last;this.last+=a.length+1;this.index++;if(a!=""){if(a[0]=="'")a=a.substring(1,a.length);if(a[a.length-1]=="'")a=a.substring(0,a.length-1)}return a};TokenIterator.prototype.hasNext=function(){return this.index<this.tokens.length};TokenIterator.prototype.hasNextN=function(a){return this.index+a<this.tokens.length}; TokenIterator.prototype.skip=function(a,b){this.index+=a;this.last+=b;if(this.index<this.tokens.length)this.count=this.last-this.tokens[this.index].length};TokenIterator.prototype.getCount=function(){return this.count};TokenIterator.prototype.peek=function(a){var b=[];a=this.index+a;for(var c=this.index;c<a;c++)b.push(this.tokens[c]);return b}; AtDCore.prototype.markMyWords=function(a,b){var c=new RegExp(this._getSeparators()),e=[],d=0,f=this;this._walk(a,function(j){j.nodeType==3&&!f.isMarkedNode(j)&&e.push(j)});var m;this.map(e,function(j){var g;if(j.nodeType==3){g=j.nodeValue;var i=j.nodeValue.split(c),l="",h=[];for(m=new TokenIterator(i);m.hasNext();){i=m.next();var o=b["__"+i],s;if(o!=undefined&&o.pretoks!=undefined){s=o.defaults;o=o.pretoks["__"+l];var k=false,p,t;p=g.substr(0,m.getCount());t=g.substr(p.length,g.length);p=function(n){if(n!= undefined&&!n.used&&v["__"+n.string]==undefined&&n.regexp.test(t)){v["__"+n.string]=1;h.push([n.regexp,'<span class="'+n.type+'" pre="'+l+'">$&</span>']);k=n.used=true}};var v={};if(o!=undefined){l+=" ";f.map(o,p)}if(!k){l="";f.map(s,p)}}l=i}if(h.length>0){newNode=j;for(g=0;g<h.length;g++){var u=h[g][0],w=h[g][1];newNode=function(n){if(n.nodeType==3){d++;return f.isIE()&&n.nodeValue.length>0&&n.nodeValue.substr(0,1)==" "?f.create('<span class="mceItemHidden">&nbsp;</span>'+n.nodeValue.substr(1,n.nodeValue.length- 1).replace(u,w),false):f.create(n.nodeValue.replace(u,w),false)}else{for(var r=f.contents(n),q=0;q<r.length;q++)if(r[q].nodeType==3&&u.test(r[q].nodeValue)){var x;x=f.isIE()&&r[q].nodeValue.length>0&&r[q].nodeValue.substr(0,1)==" "?f.create('<span class="mceItemHidden">&nbsp;</span>'+r[q].nodeValue.substr(1,r[q].nodeValue.length-1).replace(u,w),true):f.create(r[q].nodeValue.replace(u,w),true);f.replaceWith(r[q],x);f.removeParent(x);d++;return n}return n}}(newNode)}f.replaceWith(j,newNode)}}});return d}; AtDCore.prototype._walk=function(a,b){var c;for(c=0;c<a.length;c++){b.call(b,a[c]);this._walk(this.contents(a[c]),b)}};AtDCore.prototype.removeWords=function(a,b){var c=0,e=this;this.map(this.findSpans(a).reverse(),function(d){if(d&&(e.isMarkedNode(d)||e.hasClass(d,"mceItemHidden")||e.isEmptySpan(d)))if(d.innerHTML=="&nbsp;"){var f=document.createTextNode(" ");e.replaceWith(d,f)}else if(!b||d.innerHTML==b){e.removeParent(d);c++}});return c}; AtDCore.prototype.isEmptySpan=function(a){return this.getAttrib(a,"class")==""&&this.getAttrib(a,"style")==""&&this.getAttrib(a,"id")==""&&!this.hasClass(a,"Apple-style-span")&&this.getAttrib(a,"mce_name")==""};AtDCore.prototype.isMarkedNode=function(a){return this.hasClass(a,"hiddenGrammarError")||this.hasClass(a,"hiddenSpellError")||this.hasClass(a,"hiddenSuggestion")};AtDCore.prototype.applySuggestion=function(a,b){if(b=="(omit)")this.remove(a);else{var c=this.create(b);this.replaceWith(a,c);this.removeParent(c)}}; AtDCore.prototype.hasErrorMessage=function(a){return a!=undefined&&a.getElementsByTagName("message").item(0)!=null};AtDCore.prototype.getErrorMessage=function(a){return a.getElementsByTagName("message").item(0)};AtDCore.prototype.isIE=function(){return navigator.appName=="Microsoft Internet Explorer"};var AtD=jQuery.extend({proofread_click_count:0,i18n:{},listener:{}},AtD||{rpc:""});AtD.getLang=function(a,b){if(AtD[a]==undefined)return b;return AtD[a]};AtD.addI18n=function(a){AtD.i18n=a;AtD.core.addI18n(a)}; AtD.setIgnoreStrings=function(a){AtD.core.setIgnoreStrings(a)};AtD.showTypes=function(a){AtD.core.showTypes(a)}; AtD.check=function(a,b){typeof AtD.proofread_click_count!="undefined"&&AtD.proofread_click_count++;AtD.callback_f=b;AtD.remove(a);var c=jQuery("#"+a);c.html();text=jQuery.trim(c.html());text=encodeURIComponent(text);jQuery.ajax({type:"POST",url:AtD.rpc,data:"data="+text,format:"raw",dataType:jQuery.browser.msie?"text":"xml",error:function(e,d,f){AtD.callback_f!=undefined&&AtD.callback_f.error!=undefined&&AtD.callback_f.error(d+": "+f)},success:function(e){var d;if(typeof e=="string"){d=new ActiveXObject("Microsoft.XMLDOM"); d.async=false;d.loadXML(e)}else d=e;if(AtD.core.hasErrorMessage(d))AtD.callback_f!=undefined&&AtD.callback_f.error!=undefined&&AtD.callback_f.error(AtD.core.getErrorMessage(d));else{AtD.container=a;e=AtD.processXML(a,d);AtD.callback_f!=undefined&&AtD.callback_f.ready!=undefined&&AtD.callback_f.ready(e);e==0&&AtD.callback_f!=undefined&&AtD.callback_f.success!=undefined&&AtD.callback_f.success(e);AtD.counter=e;AtD.count=e}}})};AtD.remove=function(a){AtD._removeWords(a,null)}; AtD.clickListener=function(a){AtD.core.isMarkedNode(a.target)&&AtD.suggest(a.target)};AtD.processXML=function(a,b){var c=AtD.core.processXML(b);if(c.count>0)c.count=AtD.core.markMyWords(jQuery("#"+a).contents(),c.errors);jQuery("#"+a).unbind("click",AtD.clickListener);jQuery("#"+a).click(AtD.clickListener);return c.count};AtD.useSuggestion=function(a){this.core.applySuggestion(AtD.errorElement,a);AtD.counter--;AtD.counter==0&&AtD.callback_f!=undefined&&AtD.callback_f.success!=undefined&&AtD.callback_f.success(AtD.count)}; AtD.editSelection=function(){AtD.errorElement.parent();AtD.callback_f!=undefined&&AtD.callback_f.editSelection!=undefined&&AtD.callback_f.editSelection(AtD.errorElement)};AtD.ignoreSuggestion=function(){AtD.core.removeParent(AtD.errorElement);AtD.counter--;AtD.counter==0&&AtD.callback_f!=undefined&&AtD.callback_f.success!=undefined&&AtD.callback_f.success(AtD.count)}; AtD.ignoreAll=function(a){var b=AtD.errorElement.text();a=AtD._removeWords(a,b);AtD.counter-=a;AtD.counter==0&&AtD.callback_f!=undefined&&AtD.callback_f.success!=undefined&&AtD.callback_f.success(AtD.count);if(AtD.callback_f!=undefined&&AtD.callback_f.ignore!=undefined&&AtD.rpc_ignore!=undefined){AtD.callback_f.ignore(b);AtD.core.setIgnoreStrings(b)}};AtD.explainError=function(){AtD.callback_f!=undefined&&AtD.callback_f.explain!=undefined&&AtD.callback_f.explain(AtD.explainURL)}; AtD.suggest=function(a){if(jQuery("#suggestmenu").length==0){var b=jQuery('<div id="suggestmenu"></div>');b.prependTo("body")}else{b=jQuery("#suggestmenu");b.hide()}errorDescription=AtD.core.findSuggestion(a);AtD.errorElement=jQuery(a);b.empty();if(errorDescription==undefined)b.append("<strong>"+AtD.getLang("menu_title_no_suggestions","No suggestions")+"</strong>");else if(errorDescription.suggestions.length==0)b.append("<strong>"+errorDescription.description+"</strong>");else{b.append("<strong>"+ errorDescription.description+"</strong>");for(var c=0;c<errorDescription.suggestions.length;c++)(function(e){b.append("<a onclick=\"AtD.useSuggestion('"+e.replace(/'/,"\\'")+"');\">"+e+"</a>")})(errorDescription.suggestions[c])}if(AtD.callback_f!=undefined&&AtD.callback_f.explain!=undefined&&errorDescription.moreinfo!=undefined){b.append('<a onclick="AtD.explainError();" class="spell_sep_top">'+AtD.getLang("menu_option_explain","Explain...")+"</a>");AtD.explainURL=errorDescription.moreinfo}b.append('<a onclick="AtD.ignoreSuggestion();" class="spell_sep_top">'+ AtD.getLang("menu_option_ignore_once","Ignore suggestion")+"</a>");if(AtD.callback_f!=undefined&&AtD.callback_f.editSelection!=undefined){AtD.callback_f!=undefined&&AtD.callback_f.ignore!=undefined&&AtD.rpc_ignore!=undefined?b.append("<a onclick=\"AtD.ignoreAll('"+AtD.container+"');\">"+AtD.getLang("menu_option_ignore_always","Ignore always")+"</a>"):b.append("<a onclick=\"AtD.ignoreAll('"+AtD.container+"');\">"+AtD.getLang("menu_option_ignore_all","Ignore all")+"</a>");b.append("<a onclick=\"AtD.editSelection('"+ AtD.container+'\');" class="spell_sep_bottom spell_sep_top">'+AtD.getLang("menu_option_edit_selection","Edit Selection...")+"</a>")}else AtD.callback_f!=undefined&&AtD.callback_f.ignore!=undefined&&AtD.rpc_ignore!=undefined?b.append("<a onclick=\"AtD.ignoreAll('"+AtD.container+'\');" class="spell_sep_bottom">'+AtD.getLang("menu_option_ignore_always","Ignore always")+"</a>"):b.append("<a onclick=\"AtD.ignoreAll('"+AtD.container+'\');" class="spell_sep_bottom">'+AtD.getLang("menu_option_ignore_all", "Ignore all")+"</a>");c=jQuery(a).offset();a=jQuery(a).width();jQuery(b).css({left:c.left+a+"px",top:c.top+"px"});jQuery(b).fadeIn(200);AtD.suggestShow=true;setTimeout(function(){jQuery("body").bind("click",function(){AtD.suggestShow||jQuery("#suggestmenu").fadeOut(200)})},1);setTimeout(function(){AtD.suggestShow=false},2)};AtD._removeWords=function(a,b){return this.core.removeWords(jQuery("#"+a),b)}; AtD.initCoreModule=function(){var a=new AtDCore;a.hasClass=function(b,c){return jQuery(b).hasClass(c)};a.map=jQuery.map;a.contents=function(b){return jQuery(b).contents()};a.replaceWith=function(b,c){return jQuery(b).replaceWith(c)};a.findSpans=function(b){return jQuery.makeArray(b.find("span"))};a.create=function(b){return jQuery('<span class="mceItemHidden">'+b+"</span>")};a.remove=function(b){return jQuery(b).remove()};a.removeParent=function(b){return jQuery(b).unwrap?jQuery(b).contents().unwrap(): jQuery(b).replaceWith(jQuery(b).html())};a.getAttrib=function(b,c){return jQuery(b).attr(c)};return a};AtD.core=AtD.initCoreModule(); (function(a){a.alerts={verticalOffset:-75,horizontalOffset:0,repositionOnResize:true,overlayOpacity:0.01,overlayColor:"#FFF",draggable:false,okButton:"&nbsp;"+AtD.getLang("button_ok","OK")+"&nbsp;",cancelButton:"&nbsp;"+AtD.getLang("button_cancel","Cancel")+"&nbsp;",dialogClass:null,alert:function(b,c,e){if(c==null)c="Alert";a.alerts._show(c,b,null,"alert",function(d){e&&e(d)})},confirm:function(b,c,e){if(c==null)c="Confirm";a.alerts._show(c,b,null,"confirm",function(d){e&&e(d)})},prompt:function(b, c,e,d){if(e==null)e="Prompt";a.alerts._show(e,b,c,"prompt",function(f){d&&d(f)})},_show:function(b,c,e,d,f){a.alerts._hide();a.alerts._overlay("show");a("BODY").append('<div id="popup_container"><h1 id="popup_title"></h1><div id="popup_content"><div id="popup_message"></div></div></div>');a.alerts.dialogClass&&a("#popup_container").addClass(a.alerts.dialogClass);var m=a.browser.msie&&parseInt(a.browser.version)<=6?"absolute":"fixed";a("#popup_container").css({position:m,zIndex:99999,padding:0,margin:0}); a("#popup_title").text(b);a("#popup_content").addClass(d);a("#popup_message").text(c);a("#popup_message").html(a("#popup_message").text().replace(/\n/g,"<br />"));a("#popup_container").css({minWidth:a("#popup_container").outerWidth(),maxWidth:a("#popup_container").outerWidth()});a.alerts._reposition();a.alerts._maintainPosition(true);switch(d){case "alert":a("#popup_message").after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /></div>');a("#popup_ok").click(function(){a.alerts._hide(); f(true)});a("#popup_ok").focus().keypress(function(g){if(g.keyCode==13||g.keyCode==27)a("#popup_ok").trigger("click")});break;case "confirm":a("#popup_message").after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /> <input type="button" value="'+a.alerts.cancelButton+'" id="popup_cancel" /></div>');a("#popup_ok").click(function(){a.alerts._hide();f&&f(true)});a("#popup_cancel").click(function(){a.alerts._hide();f&&f(false)});a("#popup_ok").focus();a("#popup_ok, #popup_cancel").keypress(function(g){g.keyCode== 13&&a("#popup_ok").trigger("click");g.keyCode==27&&a("#popup_cancel").trigger("click")});break;case "prompt":a("#popup_message").append('<br /><input type="text" size="30" id="popup_prompt" />').after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /> <input type="button" value="'+a.alerts.cancelButton+'" id="popup_cancel" /></div>');a("#popup_prompt").width(a("#popup_message").width());a("#popup_ok").click(function(){var g=a("#popup_prompt").val();a.alerts._hide(); f&&f(g)});a("#popup_cancel").click(function(){a.alerts._hide();f&&f(null)});a("#popup_prompt, #popup_ok, #popup_cancel").keypress(function(g){g.keyCode==13&&a("#popup_ok").trigger("click");g.keyCode==27&&a("#popup_cancel").trigger("click")});e&&a("#popup_prompt").val(e);a("#popup_prompt").focus().select();break}if(a.alerts.draggable)try{a("#popup_container").draggable({handle:a("#popup_title")});a("#popup_title").css({cursor:"move"})}catch(j){}},_hide:function(){a("#popup_container").remove();a.alerts._overlay("hide"); a.alerts._maintainPosition(false)},_overlay:function(b){switch(b){case "show":a.alerts._overlay("hide");a("BODY").append('<div id="popup_overlay"></div>');a("#popup_overlay").css({position:"absolute",zIndex:99998,top:"0px",left:"0px",width:"100%",height:a(document).height(),background:a.alerts.overlayColor,opacity:a.alerts.overlayOpacity});break;case "hide":a("#popup_overlay").remove();break}},_reposition:function(){var b=a(window).height()/2-a("#popup_container").outerHeight()/2+a.alerts.verticalOffset, c=a(window).width()/2-a("#popup_container").outerWidth()/2+a.alerts.horizontalOffset;if(b<0)b=0;if(c<0)c=0;if(a.browser.msie&&parseInt(a.browser.version)<=6)b+=a(window).scrollTop();a("#popup_container").css({top:b+"px",left:c+"px"});a("#popup_overlay").height(a(document).height())},_maintainPosition:function(b){if(a.alerts.repositionOnResize)switch(b){case true:a(window).bind("resize",a.alerts._reposition);break;case false:a(window).unbind("resize",a.alerts._reposition);break}}};jAlert=function(b, c,e){a.alerts.alert(b,c,e)};jConfirm=function(b,c,e){a.alerts.confirm(b,c,e)};jPrompt=function(b,c,e,d){a.alerts.prompt(b,c,e,d)}})(jQuery);AtD.textareas={}; AtD.restoreTextArea=function(a){AtD_ajax_load("hide");var b=AtD.textareas[a];if(!(b==undefined||b.before==b.link.html())){AtD.remove(a);jQuery("#AtD_sync_").remove();var c;c=navigator.appName=="Microsoft Internet Explorer"?jQuery("#"+a).html().replace(/<BR.*?class.*?atd_remove_me.*?>/gi,"\n"):jQuery("#"+a).html();jQuery("#"+a).replaceWith(b.node);jQuery("#"+a).val(c.replace(/\&lt\;/g,"<").replace(/\&gt\;/,">").replace(/\&amp;/g,"&"));jQuery("#"+a).height(b.height);b.link.html(b.before)}}; AtD.checkTextArea=function(a,b,c){AtD._checkTextArea(a,AtD.check,b,c)}; AtD._checkTextArea=function(a,b,c,e){var d=jQuery("#"+a);if(AtD.textareas[a]==undefined){for(var f={},m=function(k,p){if(p.css(k)!="")f[k]=p.css(k)},j=["background-color","color","font-size","font-family","border-top-width","border-bottom-width","border-left-width","border-right-width","border-top-style","border-bottom-style","border-left-style","border-right-style","border-top-color","border-bottom-color","border-left-color","border-right-color","text-align","margin-top","margin-bottom","margin-left", "margin-right","width","line-height","letter-spacing","left","right","top","bottom","position","padding-left","padding-right","padding-top","padding-bottom"],g=0;g<j.length;g++)m(j[g],d);AtD.textareas[a]={node:d,height:d.height(),link:jQuery("#"+c),before:jQuery("#"+c).html(),after:e,style:f}}var i=AtD.textareas[a];if(i.link.html()!=i.before)AtD.restoreTextArea(a);else{i.link.html(i.after);var l=function(){return false};i.link.click(l);var h,o=jQuery('<input type="hidden" />');o.attr("id","AtD_sync_"); o.val(d.val());c=d.attr("name");if(navigator.appName=="Microsoft Internet Explorer"){d.replaceWith('<div id="'+a+'">'+d.val().replace(/\&/g,"&amp;").replace(/[\n\r\f]/gm,'<BR class="atd_remove_me">')+"</div>");h=jQuery("#"+a);h.attr("style",i.node.attr("style"));h.attr("class",i.node.attr("class"));h.css({overflow:"auto"});i.style["font-size"]=undefined;i.style["font-family"]=undefined}else{d.replaceWith('<div id="'+a+'">'+d.val().replace(/\&/g,"&amp;")+"</div>");h=jQuery("#"+a);h.attr("style",i.node.attr("style")); h.attr("class",i.node.attr("class"));h.css({overflow:"auto","white-space":"pre-wrap"});h.attr("contenteditable","true");h.attr("spellcheck",false);h.css({outline:"none"})}h.keypress(function(k){return k.keyCode!=13});o.attr("name",c);h.after(o);var s=false;d=function(){if(!s){s=true;setTimeout(function(){var k;k=navigator.appName=="Microsoft Internet Explorer"?h.html().replace(/<BR.*?class.*?atd_remove_me.*?>/gi,"\n"):h.html();var p=jQuery("<div></div>");p.html(k);AtD.core.removeWords(p);o.val(p.html().replace(/\&lt\;/g, "<").replace(/\&gt\;/,">").replace(/\&amp;/g,"&"));s=false},1500)}};h.keypress(d);h.mousemove(d);h.mouseout(d);h.css(i.style);h.height(i.height);AtD_ajax_load("show");b(a,{ready:function(){i.link.unbind("click",l);AtD_ajax_load("hide")},explain:function(k){window.open(k,"","width=480,height=380,toolbar=0,status=0,resizable=0,location=0,menuBar=0,left="+(screen.width/2-240)+",top="+(screen.height/2-190)).focus()},success:function(k){k==0&&jAlert(AtD.getLang("message_no_errors_found","No writing errors were found!"), AtD.getLang("message_no_errors","No errors!"));AtD.restoreTextArea(a)},error:function(k){i.link.unbind("click",l);k==undefined?jAlert(AtD.getLang("message_server_error_short","There was an error communicating with the spell checking service."),AtD.getLang("message_error","Error!")):jAlert(AtD.getLang("message_server_error_short","There was an error communicating with the spell checking service.")+"\n\n"+k,AtD.getLang("message_error","Error!"));AtD.restoreTextArea(a)},editSelection:function(k){var p= k.text();jPrompt(AtD.getLang("dialog_replace_selection","Replace selection with:"),k.text(),AtD.getLang("dialog_replace","Replace"),function(t){if(t!=null&&p!=t){jQuery(k).html(t);AtD.core.removeParent(k);AtD.counter--;AtD.counter==0&&AtD.restoreTextArea(a)}})},ignore:function(k){AtD_ajax_load("show");jQuery.ajax({type:"POST",url:AtD.rpc_ignore+encodeURI(k).replace(/&/g,"%26"),data:"action=atd_ignore",format:"raw",timeout:5E3,error:function(p,t,v){AtD.callback_f!=undefined&&AtD.callback_f.error!= undefined&&AtD.callback_f.error(t+": "+v)},success:function(){AtD_ajax_load("hide")}})}})}};function AtD_acceptAllChanges(){var a=AtD.core;AtD.core.map(AtD.core.findSpans(jQuery("#"+AtD.current_id)).reverse(),function(b){if(a.isMarkedNode(b)){var c=a.findSuggestion(b);c!=undefined&&c.suggestions!=undefined&&c.suggestions.length>0&&a.applySuggestion(b,c.suggestions[0])}})} function AtD_check(a,b){AtD_ajax_load("show");jQuery.ajax({type:"POST",url:AtD.rpc,data:"data="+jQuery("#"+a).val(),format:"raw",dataType:jQuery.browser.msie?"text":"xml",error:function(){AtD_update_post(a)},success:function(c){var e;if(typeof c=="string"){e=new ActiveXObject("Microsoft.XMLDOM");e.async=false;e.loadXML(c)}else e=c;AtD_ajax_load("hide");AtD.core.hasErrorMessage(e)&&AtD_update_post(a);if(AtD.core.processXML(e).count>0){c=AtD.getLang("dialog_confirm_post","The proofreader has suggestions for your reply. Are you sure you want to post it?")+ "\n\n"+AtD.getLang("dialog_confirm_post2","Press OK to post your reply, or Cancel to view the suggestions and edit your reply.");jConfirm(c,"",function(d){d==true?AtD_update_post(a):b.click()})}else AtD_update_post(a)}})}function AtD_update_post(a){AtD.proofread_click_count=2;jQuery("#"+a).parents("form").submit()} function AtD_ajax_load(a){if(a==undefined)jQuery(".atd-ajax-load").css("height")=="16px"?jQuery(".atd-ajax-load").css("height","0"):jQuery(".atd-ajax-load").css("height","16px");else a=="show"?jQuery(".atd-ajax-load").css("height","16px"):jQuery(".atd-ajax-load").css("height","0")} jQuery.fn.addProofreader=function(a){this.id=0;var b=this,c=jQuery.extend({},jQuery.fn.addProofreader.defaults,a);return this.each(function(){$this=jQuery(this);if($this.css("display")!="none"){$this.attr("id").length==0&&$this.attr("id","AtD_"+b.id++);var e=$this.attr("id"),d=jQuery("<span></span>");d.attr("id","AtD_"+b.id++);d.html(c.proofread_content);d.click(function(){AtD.current_id!=undefined&&AtD.current_id!=e&&AtD.restoreTextArea(AtD.current_id);if($this.val()!=""){AtD.checkTextArea(e,d.attr("id"), c.edit_text_content);AtD.current_id=e}else jAlert(AtD.getLang("message_error_no_text","Please enter some text in the post textbox to be checked!"),AtD.getLang("message_error","Error!"))});$this.wrap("<div></div>");$this.before('<span class="atd-ajax-load"></span>');$this.parents("form").submit(function(f){AtD.restoreTextArea(e);if(AtD.autoproofread!=undefined&&AtD.autoproofread==1&&AtD.proofread_click_count<=0&&$this.val()!=""){f.preventDefault();AtD_check(e,d)}});$this.before(d)}})}; jQuery.fn.addProofreader.defaults={edit_text_content:'<span class="atd_container"><a class="checkLink">'+AtD.getLang("button_edit_text","Edit Text")+'</a> | <a class="acceptAllLink" onclick="AtD_acceptAllChanges();">'+AtD.getLang("button_accept_all","Accept All")+"</a></span>",proofread_content:'<span class="atd_container"><a class="checkLink">'+AtD.getLang("button_proofread","Proofread")+"</a></span>"}; jQuery(function(){jQuery("textarea").addProofreader();AtD.ignoreStrings!=undefined&&AtD.setIgnoreStrings(AtD.ignoreStrings);AtD.ignoreTypes!=undefined&&AtD.showTypes(AtD.ignoreTypes)});